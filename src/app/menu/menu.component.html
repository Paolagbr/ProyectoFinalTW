<div class="menu-container">
  <!-- Selector de opciones -->
  <mat-radio-group [(ngModel)]="selectedOption" aria-label="Selecciona una opción"
    class="menu-radio flex flex-col gap-2 mb-6">
    <mat-radio-button *ngFor="let opt of options" [value]="opt.value">
      {{ opt.label }}
    </mat-radio-button>
  </mat-radio-group>

  <!-- OPCIÓN 1: AGENDAR CITA -->
  <div *ngIf="selectedOption === '1'">
    <form class="formulario-cita" #form="ngForm">
      <h2 class="titulo">AGENDAR CITA</h2>

      <!-- Nombre -->
      <div class="campo mb-3">
        <label class="label-genero">Nombre:</label>
        <mat-form-field appearance="fill" class="w-full">
          <mat-label>Nombre</mat-label>
          <input
            matInput
            type="text"
            placeholder="Ingresa tu nombre"
            [(ngModel)]="userINFO.name"
            name="nombre"
            #nameControl="ngModel"
            pattern="^[A-Za-zÁÉÍÓÚáéíóúÑñ\s]+$"
            minlength="1"
            required
          />
        </mat-form-field>
        <div *ngIf="nameControl.touched && nameControl.hasError('required')" class="text-error">
          El campo es requerido
        </div>
        <div *ngIf="nameControl.hasError('pattern')" class="text-error">
          No se permiten números ni símbolos
        </div>
      </div>

      <!-- Servicio -->
      <div class="campo mb-3">
        <label class="label-genero">Servicio:</label>
        <mat-form-field appearance="fill" class="w-full">
          <mat-label>Servicio</mat-label>
          <mat-select
            [(ngModel)]="userINFO.grupo"
            name="grupo"
            #grupoSelect="ngModel"
            (selectionChange)="guardarServicio($event)"
            required
          >
            <mat-option *ngFor="let g of grupos" [value]="g.id">
              {{ g.nomServicio }}
            </mat-option>
          </mat-select>
        </mat-form-field>
        <div *ngIf="grupoSelect.touched && grupoSelect.hasError('required')" class="text-error">
          El campo es requerido
        </div>
        <div
          *ngIf="
            grupoSelect.touched &&
            (grupoSelect.hasError('required') || userINFO.grupo === 0)
          "
          class="text-error"
        >
          El campo es requerido o el servicio seleccionado no es válido.
        </div>
      </div>

      <!-- Sexo -->
      <div class="campo mb-3">
        <label class="label-genero">Sexo:</label>
        <mat-radio-group
          [(ngModel)]="userINFO.sexo"
          name="sexo"
          #sexoControl="ngModel"
          required
        >
          <mat-radio-button *ngFor="let s of genero" [value]="s.genero">
            {{ s.genero }}
          </mat-radio-button>
        </mat-radio-group>
        <div *ngIf="sexoControl.touched && sexoControl.hasError('required')" class="text-error">
          El campo es requerido
        </div>
      </div>

      <!-- Fecha -->
      <div class="campo mb-3">
        <label class="label-genero">Fecha:</label>
        <mat-form-field appearance="fill" class="w-full">
          <mat-label>Fecha de la cita</mat-label>
          <input
            matInput
            [matDatepicker]="picker"
            [(ngModel)]="userINFO.fechaCita"
            name="fecha"
            [matDatepickerFilter]="myFilter"
            (dateChange)="guardarFecha($event)"
            #fechaControl="ngModel"
            required
          />
          <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
          <mat-datepicker #picker></mat-datepicker>
        </mat-form-field>
        <div *ngIf="fechaControl.touched && fechaControl.hasError('required')" class="text-error">
          El campo es requerido
        </div>
      </div>

      <!-- Hora -->
      <div class="campo mb-4">
        <label class="label-genero">Hora:</label>
        <mat-form-field appearance="fill" class="w-full">
          <mat-label>Hora</mat-label>
          <mat-select
            [(ngModel)]="userINFO.hora"
            name="hora"
            #horaControl="ngModel"
            (selectionChange)="guardarHora($event)"
            required
          >
            <mat-option *ngFor="let h of horas" [value]="h.horaC" [disabled]="horasOcupadas.includes(h.horaC)">
              {{ h.horaC }}
            </mat-option>
          </mat-select>
        </mat-form-field>
        <div *ngIf="horaControl.touched && horaControl.hasError('required')" class="text-error">
          El campo es requerido
        </div>
      </div>

      <!-- Botón -->
      <div class="boton-contenedor">
        <button
          mat-raised-button
          color="primary"
          (click)="guardarCita()"
          [disabled]="!form.valid"
          [ngClass]="form.valid ? 'btn-activo' : 'btn-inactivo'"
        >
          Agendar
        </button>
      </div>
    </form>

    <!-- LISTADO DE CITAS -->
    <div id="container2" class="mt-6">
      <h2>Listado de Citas</h2>
      <table class="table table-striped w-full">
        <thead>
          <tr>
            <th>Nombre</th>
            <th>Servicio</th>
            <th>Sexo</th>
            <th>Fecha</th>
            <th>Hora</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let u of listaCitas; let i = index">
            <td>{{ u.name }}</td>
            <td>{{ getNomServicio(u.grupo) }}</td>
            <td>{{ u.sexo }}</td>
            <td>{{ u.fechaCita | date: 'shortDate' }}</td>
            <td>{{ u.hora }}</td>
            <td class="flex gap-2">
              <button mat-button color="primary" (click)="editarUsuario(u)">Editar</button>
              <button mat-button color="warn" (click)="eliminarUsuario(u)">Borrar</button>
            </td>
          </tr>
          <tr *ngIf="listaCitas.length === 0">
            <td colspan="6" class="text-center">No hay citas por el momento</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- OPCIÓN 2: QUEJAS Y SUGERENCIAS -->
  <div *ngIf="selectedOption === '2'">
    <div class="form-card1">
      <h1 class="form-title1">Quejas y Sugerencias</h1>

      <div class="form-body1">
        <form [formGroup]="formulario" (ngSubmit)="enviarComentario()">
          <!-- Nombre -->
          <div class="form-group1">
            <label class="form-label1">Nombre</label>
            <input
              type="text"
              formControlName="nombre"
              class="form-control1"
              placeholder="Ingresa tu nombre"
            />
            <div
              *ngIf="
                formulario.get('nombre')?.invalid &&
                formulario.get('nombre')?.touched
              "
              class="alert alert-danger mt-2"
            >
              El nombre es obligatorio
            </div>
          </div>

          <!-- Email -->
          <div class="form-group1">
            <label class="form-label1">Email</label>
            <input
              type="email"
              formControlName="email"
              class="form-control1"
              placeholder="Ingresa tu email"
            />
            <div
              *ngIf="
                formulario.get('email')?.invalid &&
                formulario.get('email')?.touched
              "
              class="alert alert-danger mt-2"
            >
              <span *ngIf="formulario.get('email')?.errors?.['required']"
                >El email es obligatorio</span
              >
              <span *ngIf="formulario.get('email')?.errors?.['email']"
                >El email debe ser válido</span
              >
            </div>
          </div>

          <!-- Feedback -->
          <label class="form-label1">¿Qué fue lo que más te gustó de la página?</label>
          <div formGroupName="feedback" class="checkbox-group1 mb-3">
            <label
              ><input type="checkbox" formControlName="facilidadNavegar" />
              Facilidad de navegar</label
            ><br />
            <label
              ><input type="checkbox" formControlName="buenaPresentacion" />
              Buena presentación</label
            ><br />
            <label
              ><input type="checkbox" formControlName="facilEntender" />
              Fácil de entender los servicios</label
            ><br />
            <label
              ><input type="checkbox" formControlName="estructuraUtilizada" />
              La estructura que se utilizó</label
            >
          </div>

          <!-- Servicio -->
          <label for="servicio" class="form-label1">Servicio que más te gustó</label
          ><br />
          <select formControlName="servicio" id="servicio" class="form-select1 mb-3" required>
            <option value="" disabled selected>Selecciona una opción</option>
            <option value="Masaje Corporal">Masaje corporal</option>
            <option value="Facial">Facial</option>
            <option value="Sauna">Sauna</option>
            <option value="Aromaterapia">Aromaterapia</option>
            <option value="Masaje para Pies y Manos">Masaje en pies y manos</option>
            <option value="Sala de Relajación">Sala de relajación</option>
            <option value="Atencion al cliente">Atención al cliente</option>
          </select>

          <!-- Mensaje -->
          <div class="form-group1">
            <label class="form-label1">Mensaje de queja o sugerencia</label>
            <textarea
              formControlName="mensaje"
              class="form-control1"
              placeholder="Escribe tu queja o sugerencia aquí"
              rows="5"
            ></textarea>
            <div
              *ngIf="
                formulario.get('mensaje')?.invalid &&
                formulario.get('mensaje')?.touched
              "
              class="alert alert-danger mt-2"
            >
              El mensaje es obligatorio y debe tener al menos 10 caracteres
            </div>
          </div>

          <!-- Fecha -->
          <div class="form-group1 mb-3">
            <label class="form-label1">¿En qué fecha volverías a venir?</label
            ><br />
            <mat-form-field appearance="fill" class="mat-form-field1">
              <mat-label>Fecha de la cita</mat-label>
              <input
                matInput
                [matDatepicker]="picker2"
                formControlName="fechaCita"
                required
                [matDatepickerFilter]="myFilter"
              />
              <mat-datepicker-toggle matSuffix [for]="picker2"></mat-datepicker-toggle>
              <mat-datepicker #picker2></mat-datepicker>
            </mat-form-field>
            <div
              *ngIf="
                formulario.get('fechaCita')?.touched &&
                formulario.get('fechaCita')?.hasError('required')
              "
              class="text-error1"
            >
              El campo es requerido
            </div>
          </div>

          <button
            type="submit"
            [disabled]="formulario.invalid"
            class="submit-button1"
          >
            {{ modoEdicion ? 'Actualizar Comentario' : 'Enviar Comentario' }}
          </button>
        </form>
      </div>
    </div>

    <!-- LISTADO DE COMENTARIOS -->
    <div id="container2" class="mt-6">
      <h2>Comentarios</h2>
      <table class="table table-striped w-full">
        <thead>
          <tr>
            <th>Nombre</th>
            <th>Email</th>
            <th>Mejor Aspecto</th>
            <th>Mejor Servicio</th>
            <th>Comentario</th>
            <th>Fecha</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let com of comentarios">
            <td>{{ com.nombre }}</td>
            <td>{{ com.email }}</td>
            <td>
              <ul>
                <li *ngIf="com.feedback?.facilidadNavegar">Facilidad de navegar</li>
                <li *ngIf="com.feedback?.buenaPresentacion">Buena presentación</li>
                <li *ngIf="com.feedback?.facilEntender">Fácil de entender los servicios</li>
                <li *ngIf="com.feedback?.estructuraUtilizada">La estructura que se utilizó</li>
              </ul>
            </td>
            <td>{{ com.servicio }}</td>
            <td>{{ com.mensaje }}</td>
            <td>{{ com.fechaCita | date:'shortDate' }}</td>
            <td class="flex gap-2">
              <button mat-button color="primary" (click)="editarComentario(com)">Editar</button>
              <button mat-button color="warn" (click)="eliminarComentario(com)">Borrar</button>
            </td>
          </tr>
          <tr *ngIf="comentarios.length === 0">
            <td colspan="7" class="text-center">No hay comentarios por el momento</td>
          </tr>
        </tbody>
      </table>

      <button mat-raised-button color="primary" (click)="linkGoogleAccount()">
        Agendar
      </button>
    </div>
  </div>
</div>
